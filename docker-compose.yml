version: "3.8"

services:
  pgsql.my:
    image: pgsql
    volumes:
      - pgsql_socket:/var/run/postgresql/
      - pgsql_data:/var/lib/postgresql/data
      - php_fpm_socket:/run/php-fpm/
    ports:
      - "5432:5432"
    environment:
      POSTGRES_PASSWORD: pgsql424258541

  php-fpm.my:
    image: mphp8-fpm
    volumes:
      - ./config/php/php.ini:/usr/local/etc/php/php.ini
      - ./config/php-fpm/php-fpm.d/www.conf:/usr/local/etc/php-fpm.d/www.conf
      - ./config/php-fpm/php-fpm.d/zz-docker.conf:/usr/local/etc/php-fpm.d/zz-docker.conf
      - ./www/index.php:/var/www/html/index.php
      - pgsql_socket:/var/run/postgresql/
      - php_fpm_socket:/run/php-fpm/

  nginx:
    image: nginx:alpine
    volumes:
      - ./config/nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./config/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf
      - ./www/index.php:/var/www/html/index.php
      - php_fpm_socket:/run/php-fpm/
    ports:
      - "8080:80"

volumes:
  pgsql_data:
  pgsql_socket:
  php_fpm_socket:
